<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance List</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-8">

  <!-- ✅ Header -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-gray-700">Attendance List</h1>
    <button onclick="window.location.href='index.html'" 
        class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700">
  ⬅ Back to Dashboard
</button>
  </div>

  <!-- Filters -->
  <div class="mb-6 flex flex-wrap gap-4">
    <div>
      <label for="lecture-filter" class="block text-sm font-medium text-gray-700 mb-1">Lecture Number:</label>
      <input type="number" id="lecture-filter" min="1" value="1" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400">
    </div>
    <div>
      <label for="date-filter" class="block text-sm font-medium text-gray-700 mb-1">Date:</label>
      <input type="date" id="date-filter" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400">
    </div>
    <div class="self-end">
      <button id="filter-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700">
        Apply Filter
      </button>
    </div>
  </div>

  <!-- ✅ Table of Students -->
  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <table class="min-w-full text-sm text-gray-700">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="px-6 py-3 text-left">Date</th>
          <th class="px-6 py-3 text-left">Lecture No.</th>
          <th class="px-6 py-3 text-left">Student Name</th>
          <th class="px-6 py-3 text-left">Roll Number</th>
          <th class="px-6 py-3 text-left">Status</th>
          <th class="px-6 py-3 text-left">Time</th>
        </tr>
      </thead>
      <tbody id="attendance-table-body">
        <tr class="border-b">
          <td colspan="6" class="px-6 py-4 text-center">Loading attendance data...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // DOM Elements
    const attendanceTableBody = document.getElementById('attendance-table-body');
    const dateFilter = document.getElementById('date-filter');
    const filterBtn = document.getElementById('filter-btn');
    
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    dateFilter.value = today;
    
    // Fetch attendance data on page load
    fetchAttendanceData();
    
    // Add event listener for filter button
    filterBtn.addEventListener('click', fetchAttendanceData);
    
    // Fetch attendance data from API
    async function fetchAttendanceData() {
      try {
        const date = dateFilter.value;
        const response = await fetch(`/api/attendance?date=${date}`);
        const data = await response.json();
        
        if (data.success && data.attendance) {
          renderAttendanceTable(data.attendance);
        } else {
          attendanceTableBody.innerHTML = `
            <tr class="border-b">
              <td colspan="6" class="px-6 py-4 text-center text-red-500">
                Failed to load attendance data
              </td>
            </tr>
          `;
        }
      } catch (err) {
        console.error('Error fetching attendance data:', err);
        attendanceTableBody.innerHTML = `
          <tr class="border-b">
            <td colspan="6" class="px-6 py-4 text-center text-red-500">
              Error loading attendance data
            </td>
          </tr>
        `;
      }
    }
    
    // Render attendance table
    function renderAttendanceTable(attendanceData) {
      if (attendanceData.length === 0) {
        attendanceTableBody.innerHTML = `
          <tr class="border-b">
            <td colspan="6" class="px-6 py-4 text-center">
              No attendance records found for this date
            </td>
          </tr>
        `;
        return;
      }
      
      attendanceTableBody.innerHTML = attendanceData.map(record => {
        const statusClass = 
          record.status === 'present' ? 'text-green-600' : 
          record.status === 'absent' ? 'text-red-600' : 'text-yellow-600';
        
        return `
          <tr class="border-b hover:bg-gray-50">
            <td class="px-6 py-3">${record.date}</td>
            <td class="px-6 py-3">${record.lecture_id}</td>
            <td class="px-6 py-3">${record.student.name}</td>
            <td class="px-6 py-3">${record.student.roll_number}</td>
            <td class="px-6 py-3 ${statusClass} font-semibold">${record.status.charAt(0).toUpperCase() + record.status.slice(1)}</td>
            <td class="px-6 py-3">${record.timestamp.split(' ')[1]}</td>
          </tr>
        `;
      }).join('');
    }
  </script>
</body>
</html>
